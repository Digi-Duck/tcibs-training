<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        body,
        html {
            height: 100%;
            margin: 0;
        }

        .all {
            width: 100%;
            height: 100%;

            background-color: antiquewhite;
            font-size: 20px;
        }

        .start {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            flex-direction: column;

            height: 100%;
        }

        .start-font {
            width: 100%;

            margin-bottom: 48px;

            font-size: 50px;
            font-weight: bolder;
            text-align: center;
        }

        .start-button {
            width: 200px;
            height: 100px;

            margin: 0 auto;

            font-size: 50px;
        }

        .playing {
            display: flex;

            height: 100%;
        }

        .click-area {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-around;
            align-items: center;

            width: 600px;
            height: 600px;

            margin: auto;
            padding: 10px;
            background-color: white;
            box-sizing: border-box;
        }

        .click {
            /* width: 48%;
            height: 48%; */
            background-color: rgb(87, 162, 197);
            box-sizing: border-box;
        }

        .box {
            width: 100px;
            height: 100px;
            font-size: 50px;

            position: absolute;
        }

        .active {
            display: none;
        }

        .opacity {
            opacity: 0.2;
        }
    </style>
</head>

<body>
    <div class="all">
        <div class="start active">
            <span class="start-font">color</span>
            <button class="start-button">start!!!</button>
        </div>
        <div class="playing">
            <div class="click-area"></div>
            <div class="box"></div>
        </div>
        <div class="ending active"></div>
    </div>
    <script>
        //抓取開始介面
        const start = document.querySelector('.start');
        //抓取開始按鈕
        const startButton = document.querySelector('.start-button');
        //抓取遊戲介面
        const playing = document.querySelector('.playing');
        //抓取放方塊的地方
        const clickArea = document.querySelector('.click-area');
        const box = document.querySelector('.box');
        const opacity = document.querySelector('.opacity');

        //分數
        let grade = 0;
        //邊長
        let num = 2;
        let o = 100 - num;
        let output = o/100;
        //高寬
        let w = 95 / num;
        //生方塊
        for (let i = 0; i < num * num; i++) {
            clickArea.innerHTML += '<div class="click" style="width: ' + w + '%;height:' + w + '%;"></div>';
        }
        function opacityf(elem, value) {
            elem.style.opacity = value;
        }
        function random() {
            //選取所有按的方塊
            let click = document.querySelectorAll('.click');
            //隨機答案
            randomAnswer = Math.floor(Math.random() * (num * num));

            //隨機顏色
            r = Math.floor(Math.random() * 255);
            g = Math.floor(Math.random() * 255);
            b = Math.floor(Math.random() * 255);
            
            // 套新答案
            click[randomAnswer].style.backgroundColor = `rgb(${r}, ${g}, ${b}, 0.2)`;;
            click.forEach((clickOne, index) => {
                //套顏色
                clickOne.style.backgroundColor = `rgb(${r}, ${g}, ${b})`;

                clickOne.addEventListener('click', function () {
                    console.log(randomAnswer);

                    //如果按到對的
                    if (index == randomAnswer) {
                        grade = grade + 1;

                        if (grade > 3) {
                            //清空方塊
                            clickArea.innerHTML = '';

                            num = 4;
                            o = 100 - num;
                            output = o/100;
                            w = 95 / num
                            for (let i = 0; i < num * num; i++) {
                                clickArea.innerHTML += '<div class="click" style="width: ' + w + '%;height:' + w + '%;"></div>';
                            }
                            opacity.style.opacity = output;
                        }else if(grade > 1){
                            clickArea.innerHTML = '';

                            num = 3;
                            o = 100 - num;
                            output = o/100;
                            w = 95 / num
                            for (let i = 0; i < num * num; i++) {
                                clickArea.innerHTML += '<div class="click" style="width: ' + w + '%;height:' + w + '%;"></div>';
                            }
                            opacityf(opacity, 0.5);
                        }

                        //清當前答案
                        console.log(click);
                        click[randomAnswer].style.backgroundColor = `rgb(${r}, ${g}, ${b}, 1)`;
                        
                        random()
                    }
                })
            })
        }

        random();
    </script>
</body>

</html>